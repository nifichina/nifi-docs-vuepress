<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java常用类源码——Thread源码解析 | NIFI中文文档</title>
    <meta name="description" content="NIFI中文文档">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.362009db.css" as="style"><link rel="preload" href="/assets/js/app.4deb0375.js" as="script"><link rel="preload" href="/assets/js/55.5eac4773.js" as="script"><link rel="prefetch" href="/assets/js/10.b3a23b2c.js"><link rel="prefetch" href="/assets/js/11.6dc6e8f4.js"><link rel="prefetch" href="/assets/js/12.c4e391ac.js"><link rel="prefetch" href="/assets/js/13.62c683a7.js"><link rel="prefetch" href="/assets/js/14.9a610c5a.js"><link rel="prefetch" href="/assets/js/15.907799ad.js"><link rel="prefetch" href="/assets/js/16.d1d52228.js"><link rel="prefetch" href="/assets/js/17.b8ef5ac4.js"><link rel="prefetch" href="/assets/js/18.c2b2e0e6.js"><link rel="prefetch" href="/assets/js/19.321090ab.js"><link rel="prefetch" href="/assets/js/2.97aca395.js"><link rel="prefetch" href="/assets/js/20.6b952cd7.js"><link rel="prefetch" href="/assets/js/21.a6aa7914.js"><link rel="prefetch" href="/assets/js/22.8fee6dcc.js"><link rel="prefetch" href="/assets/js/23.997638d3.js"><link rel="prefetch" href="/assets/js/24.9d0fd2fc.js"><link rel="prefetch" href="/assets/js/25.a5f6357c.js"><link rel="prefetch" href="/assets/js/26.ab7186e8.js"><link rel="prefetch" href="/assets/js/27.e5801b95.js"><link rel="prefetch" href="/assets/js/28.0846aa78.js"><link rel="prefetch" href="/assets/js/29.6f9aa11e.js"><link rel="prefetch" href="/assets/js/3.a76e3a5f.js"><link rel="prefetch" href="/assets/js/30.c07fd27a.js"><link rel="prefetch" href="/assets/js/31.fe46113f.js"><link rel="prefetch" href="/assets/js/32.d4553939.js"><link rel="prefetch" href="/assets/js/33.69d9668b.js"><link rel="prefetch" href="/assets/js/34.72cbce00.js"><link rel="prefetch" href="/assets/js/35.3a40e990.js"><link rel="prefetch" href="/assets/js/36.beb500cf.js"><link rel="prefetch" href="/assets/js/37.d4613b64.js"><link rel="prefetch" href="/assets/js/38.1c689c3e.js"><link rel="prefetch" href="/assets/js/39.d6131597.js"><link rel="prefetch" href="/assets/js/4.9a9048da.js"><link rel="prefetch" href="/assets/js/40.67d63cd8.js"><link rel="prefetch" href="/assets/js/41.535bf697.js"><link rel="prefetch" href="/assets/js/42.9bed0d20.js"><link rel="prefetch" href="/assets/js/43.83bae356.js"><link rel="prefetch" href="/assets/js/44.8f46ef86.js"><link rel="prefetch" href="/assets/js/45.67c3f85a.js"><link rel="prefetch" href="/assets/js/46.a6594589.js"><link rel="prefetch" href="/assets/js/47.273a6b8c.js"><link rel="prefetch" href="/assets/js/48.518bb300.js"><link rel="prefetch" href="/assets/js/49.a937dcc8.js"><link rel="prefetch" href="/assets/js/5.e2578ffa.js"><link rel="prefetch" href="/assets/js/50.cee76f6d.js"><link rel="prefetch" href="/assets/js/51.694ffc70.js"><link rel="prefetch" href="/assets/js/52.43a4bab7.js"><link rel="prefetch" href="/assets/js/53.4ca8611e.js"><link rel="prefetch" href="/assets/js/54.bafc55b7.js"><link rel="prefetch" href="/assets/js/56.84b15f1b.js"><link rel="prefetch" href="/assets/js/57.071acbf9.js"><link rel="prefetch" href="/assets/js/58.4939b5c0.js"><link rel="prefetch" href="/assets/js/6.4038c391.js"><link rel="prefetch" href="/assets/js/7.11b8032b.js"><link rel="prefetch" href="/assets/js/8.9c48234d.js"><link rel="prefetch" href="/assets/js/9.d4e0c278.js">
    <link rel="stylesheet" href="/assets/css/0.styles.362009db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NIFI中文文档</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">首頁</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>General</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Developer</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Processors</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Controller Services</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Reporting Tasks</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>NIFI 源码系列</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>NIFI 扩展开发系列</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Java source code</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/java-source-code/ProcessBuilder.html" class="sidebar-link">ProcessBuilder</a></li><li><a href="/java-source-code/ClassLoader.html" class="sidebar-link">ClassLoader</a></li><li><a href="/java-source-code/Thread.html" class="active sidebar-link">Thread</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-source-code/Thread.html#thread-源码解析" class="sidebar-link">Thread 源码解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-source-code/Thread.html#构造方法" class="sidebar-link">构造方法</a></li><li class="sidebar-sub-header"><a href="/java-source-code/Thread.html#重要的属性" class="sidebar-link">重要的属性</a></li><li class="sidebar-sub-header"><a href="/java-source-code/Thread.html#重要的方法" class="sidebar-link">重要的方法</a></li><li class="sidebar-sub-header"><a href="/java-source-code/Thread.html#线程的状态" class="sidebar-link">线程的状态</a></li><li class="sidebar-sub-header"><a href="/java-source-code/Thread.html#getcontextclassloader-方法" class="sidebar-link">getContextClassLoader()方法</a></li></ul></li></ul></li><li><a href="/java-source-code/ContextClassLoader.html" class="sidebar-link">线程上下文类加载器</a></li><li><a href="/java-source-code/从jvm源码解读Java运行时的类加载.html" class="sidebar-link">从jvm源码解读Java运行时的类加载</a></li><li><a href="/java-source-code/Socket.html" class="sidebar-link">Java socket详解（转）</a></li><li><a href="/java-source-code/HashMap.html" class="sidebar-link">Java HashMap 新增方法(merge,compute)（转）</a></li><li><a href="/" class="sidebar-link">待续</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Jetty source code</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="java常用类源码——thread源码解析"><a href="#java常用类源码——thread源码解析" aria-hidden="true" class="header-anchor">#</a> Java常用类源码——Thread源码解析</h1> <hr> <p>编辑人：<strong><strong>酷酷的诚</strong></strong>  邮箱：<strong>zhangchengk@foxmail.com</strong></p> <hr> <p>内容：</p> <h2 id="thread-源码解析"><a href="#thread-源码解析" aria-hidden="true" class="header-anchor">#</a> Thread 源码解析</h2> <p>线程是在进程中执行的单位，线程的资源开销相对于进程的开销是相对较少的，所以我们一般创建线程执行，而不是进程执行。 下面我们就来了解一下Java Thread类源码，了解一下线程的控制吧！</p> <h3 id="构造方法"><a href="#构造方法" aria-hidden="true" class="header-anchor">#</a> 构造方法</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ThreadGroup</span> g<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>
                    <span class="token keyword">long</span> stackSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> stackSize<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ThreadGroup</span> g<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>
                    <span class="token keyword">long</span> stackSize<span class="token punctuation">,</span> <span class="token class-name">AccessControlContext</span> acc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;name cannot be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Thread</span> parent <span class="token operator">=</span> <span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">SecurityManager</span> security <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>g <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">/* Determine if it's an applet or not */</span>
          <span class="token comment">/* If there is a security manager, ask the security manager
             what to do. */</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>security <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              g <span class="token operator">=</span> security<span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">/* If the security doesn't have a strong opinion of the matter
             use the parent thread group. */</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>g <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              g <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* checkAccess regardless of whether or not threadgroup is
         explicitly passed in. */</span>
      g<span class="token punctuation">.</span><span class="token function">checkAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/*
       * Do we have the required permissions?
       */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>security <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCCLOverridden</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              security<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span>SUBCLASS_IMPLEMENTATION_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      g<span class="token punctuation">.</span><span class="token function">addUnstarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>group <span class="token operator">=</span> g<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>daemon <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>priority <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>security <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">isCCLOverridden</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>contextClassLoader <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>contextClassLoader <span class="token operator">=</span> parent<span class="token punctuation">.</span>contextClassLoader<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>inheritedAccessControlContext <span class="token operator">=</span>
              acc <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> acc <span class="token operator">:</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
      <span class="token function">setPriority</span><span class="token punctuation">(</span>priority<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>inheritableThreadLocals <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>inheritableThreadLocals <span class="token operator">=</span>
              <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">createInheritedMap</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>inheritableThreadLocals<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/* Stash the specified stack size in case the VM cares */</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>stackSize <span class="token operator">=</span> stackSize<span class="token punctuation">;</span>
      <span class="token comment">/* Set thread ID */</span>
      tid <span class="token operator">=</span> <span class="token function">nextThreadID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;Thread-&quot;</span> <span class="token operator">+</span> <span class="token function">nextThreadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">public</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token string">&quot;Thread-&quot;</span> <span class="token operator">+</span> <span class="token function">nextThreadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> target<span class="token punctuation">,</span> <span class="token class-name">AccessControlContext</span> acc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token string">&quot;Thread-&quot;</span> <span class="token operator">+</span> <span class="token function">nextThreadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token comment">// 线程名</span>
  <span class="token keyword">public</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//线程组和线程名</span>
  <span class="token keyword">public</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">ThreadGroup</span> group<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//线程任务，线程名</span>
  <span class="token keyword">public</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 线程组， 线程任务， 线程名 ，栈大小</span>
  <span class="token keyword">public</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">ThreadGroup</span> group<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">long</span> stackSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> stackSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//  ......</span>
</code></pre></div><p>上述的的Thread 的构造方法不止是上面的一些内容，还有其他带参数的组合不同的构造方法， 我们可以发现在构造方法里面执行的是init()方法，那么这个init（）方法进行的是什么样的操作呢？
通过init()方法，我们可以看到， init是一个私有的方法，其中第一个进行的操作是，判断是否具有线程名，线程名是不可以为空的，如果我们使用的是无参数构造函数，或者使用的是没有传入线程名的构造方法，那么Thread类中是会默认的为我们规定线程名字，即调用的是Thread- nextThreadNum()，对线程进行编号。 这个方法是同步的，保证了在执行的时候不会进行异步操作，避免了产生有相同的线ID的出现，源码如下:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/* For autonumbering anonymous threads. */</span>
 <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> threadInitNumber<span class="token punctuation">;</span>
 <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">nextThreadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> threadInitNumber<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>我们要注意的一点是，Thread的是实现了Runnable接口的，那么我们其中的run 方法应该怎么执行执行呢？ 在init（）方法中，我们可以找到实现了’run’方法， 它是如下实现的:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * If this thread was constructed using a separate
 * &lt;code&gt;Runnable&lt;/code&gt; run object, then that
 * &lt;code&gt;Runnable&lt;/code&gt; object's &lt;code&gt;run&lt;/code&gt; method is called;
 * otherwise, this method does nothing and returns.
 * &lt;p&gt;
 * Subclasses of &lt;code&gt;Thread&lt;/code&gt; should override this method.
 *
 * @see     #start()
 * @see     #stop()
 * @see     #Thread(ThreadGroup, Runnable, String)
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>原来里面就做了这个简单的工作，调用了target中个run方法呀！ 但是这个target是什么东西呢？ 就是我们实现了Runnable接口的对象呀，所以我们在构造方法中会传入一个Runnable接口实现对象， 这个就是 target， 所以最红线程执行的run方法是我们传入的 对象中的run方法，看到这个思路，我马上又想到了Spring中集成hibernate中的做法是一样的(你想做的操作，在外面你自己定义好，Spring暴露一个接口给你，你实现了就行，按照他的规范，就传入到Spring内部中去了，人家就帮你执行了)。</p> <p>接着看init（）方法中做了什么： 执行currentThread 方法，而这个方法又是一个本地方法（本地方法是由其他语言编写的，编译成和处理器相关的机器代码，本地方法保存在动态链接库中，即.dll(windows系统)文件中，格式是各个平台专有的，Java方法是与平台无关的，但是本地方法不是，运行中的Java方法调用本地方法时，虚拟机装载包含这个本地方法的动态库， 并调用这个方法，通过本地方法Java程序可以直接访问底层操作系统的资源），接着又做了左了是否有ThreadGroup的判断，如果没有传入线程组的话， 第一是使用SecurityManager中的ThreadGroup， 如果从SecurityManager 中获取不到ThreadGroup()， 那么就从当前线程中获取线程组（parent.getThreadGroup()），最后做了检验和些参数的赋值。</p> <h3 id="重要的属性"><a href="#重要的属性" aria-hidden="true" class="header-anchor">#</a> 重要的属性</h3> <p>接下来，我们来看看Thread类中的重要的属性有哪些吧!</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/* Make sure registerNatives is the first thing &lt;clinit&gt; does. */</span>
  <span class="token comment">// 类加载的时候，调用本地的注册本地方静态方法， 这个方法是本地方法，具体干了什么不知道</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">registerNatives</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token punctuation">{</span>
      <span class="token function">registerNatives</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">char</span>  name<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span>            priority<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Thread</span>         threadQ<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">long</span>           eetop<span class="token punctuation">;</span>
  <span class="token comment">/* Whether or not to single_step this thread. */</span>
  <span class="token keyword">private</span> <span class="token keyword">boolean</span>     single_step<span class="token punctuation">;</span>
  <span class="token comment">/* Whether or not the thread is a daemon thread. */</span>
  <span class="token comment">// 设设置这个线程是否是守护线程</span>
  <span class="token keyword">private</span> <span class="token keyword">boolean</span>     daemon <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token comment">/* JVM state */</span>
  <span class="token keyword">private</span> <span class="token keyword">boolean</span>     stillborn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token comment">/* What will be run. */</span>
  <span class="token comment">// 要执行的run方法的对象</span>
  <span class="token keyword">private</span> <span class="token class-name">Runnable</span> target<span class="token punctuation">;</span>
  <span class="token comment">/* The group of this thread */</span>
  <span class="token comment">// 这个线程的线程组</span>
  <span class="token keyword">private</span> <span class="token class-name">ThreadGroup</span> group<span class="token punctuation">;</span>
  <span class="token comment">/* The context ClassLoader for this thread */</span>
  <span class="token comment">// 这个线程的上下文类加载器</span>
  <span class="token keyword">private</span> <span class="token class-name">ClassLoader</span> contextClassLoader<span class="token punctuation">;</span>
  <span class="token comment">/* The inherited AccessControlContext of this thread */</span>
  <span class="token keyword">private</span> <span class="token class-name">AccessControlContext</span> inheritedAccessControlContext<span class="token punctuation">;</span>
  <span class="token comment">/* For autonumbering anonymous threads. */</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> threadInitNumber<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">nextThreadNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> threadInitNumber<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* ThreadLocal values pertaining to this thread. This map is maintained
   * by the ThreadLocal class. */</span>
  <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token class-name">ThreadLocalMap</span> threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">/*
   * InheritableThreadLocal values pertaining to this thread. This map is
   * maintained by the InheritableThreadLocal class.
   */</span>
  <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token class-name">ThreadLocalMap</span> inheritableThreadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">/*
   * The requested stack size for this thread, or 0 if the creator did
   * not specify a stack size.  It is up to the VM to do whatever it
   * likes with this number; some VMs will ignore it.
   */</span>
   <span class="token comment">// 给这个线程设置的栈的大小,默认为0 </span>
  <span class="token keyword">private</span> <span class="token keyword">long</span> stackSize<span class="token punctuation">;</span>
  <span class="token comment">/*
   * JVM-private state that persists after native thread termination.
   */</span>
  <span class="token keyword">private</span> <span class="token keyword">long</span> nativeParkEventPointer<span class="token punctuation">;</span>
  <span class="token comment">/*
   * Thread ID
   */</span>
   
   <span class="token comment">//线程id</span>
  <span class="token keyword">private</span> <span class="token keyword">long</span> tid<span class="token punctuation">;</span>
  <span class="token comment">/* For generating thread ID */</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> threadSeqNumber<span class="token punctuation">;</span>
  <span class="token comment">/* Java thread status for tools,
   * initialized to indicate thread 'not yet started'
   */</span>
  <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> threadStatus <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">long</span> <span class="token function">nextThreadID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">++</span>threadSeqNumber<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * The argument supplied to the current call to
   * java.util.concurrent.locks.LockSupport.park.
   * Set by (private) java.util.concurrent.locks.LockSupport.setBlocker
   * Accessed using java.util.concurrent.locks.LockSupport.getBlocker
   */</span>
  <span class="token keyword">volatile</span> <span class="token class-name">Object</span> parkBlocker<span class="token punctuation">;</span>
  <span class="token comment">/* The object in which this thread is blocked in an interruptible I/O
   * operation, if any.  The blocker's interrupt method should be invoked
   * after setting this thread's interrupt status.
   */</span>
  <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Interruptible</span> blocker<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> blockerLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* Set the blocker field; invoked via sun.misc.SharedSecrets from java.nio code
   */</span>
  <span class="token keyword">void</span> <span class="token function">blockedOn</span><span class="token punctuation">(</span><span class="token class-name">Interruptible</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>blockerLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          blocker <span class="token operator">=</span> b<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * The minimum priority that a thread can have.
   */</span>
   <span class="token comment">// 线程执行的最低优先级 为1</span>
  <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> MIN_PRIORITY <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token comment">/**
   * The default priority that is assigned to a thread.
   */</span>
   <span class="token comment">// 线程默认的执行优先级为 5</span>
  <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> NORM_PRIORITY <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * The maximum priority that a thread can have.
   */</span>
   <span class="token comment">// 线程执行的最高的优先级为 10</span>
  <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> MAX_PRIORITY <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div><p>线程的优先级在不同的平台上，对应的系统优先级会不同，可能多个优先级对应同一个系统优先级。
优先级高的线程并不一定优先执行，这个由JVM来解释并向系统提供参考.</p> <h3 id="重要的方法"><a href="#重要的方法" aria-hidden="true" class="header-anchor">#</a> 重要的方法</h3> <h4 id="start-方法"><a href="#start-方法" aria-hidden="true" class="header-anchor">#</a> start( )方法</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
    * Causes this thread to begin execution; the Java Virtual Machine
    * calls the &lt;code&gt;run&lt;/code&gt; method of this thread.
    * &lt;p&gt;
    * The result is that two threads are running concurrently: the
    * current thread (which returns from the call to the
    * &lt;code&gt;start&lt;/code&gt; method) and the other thread (which executes its
    * &lt;code&gt;run&lt;/code&gt; method).
    * &lt;p&gt;
    * It is never legal to start a thread more than once.
    * In particular, a thread may not be restarted once it has completed
    * execution.
    *
    * @exception  IllegalThreadStateException  if the thread was already
    *               started.
    * @see        #run()
    * @see        #stop()
    */</span>
   <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">/**
        * This method is not invoked for the main method thread or &quot;system&quot;
        * group threads created/set up by the VM. Any new functionality added
        * to this method in the future may have to also be added to the VM.
        *
        * A zero status value corresponds to state &quot;NEW&quot;.
        */</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>threadStatus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalThreadStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">/* Notify the group that this thread is about to be started
        * so that it can be added to the group's list of threads
        * and the group's unstarted count can be decremented. */</span>
       group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">boolean</span> started <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           started <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
           <span class="token keyword">try</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>started<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   group<span class="token punctuation">.</span><span class="token function">threadStartFailed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">/* do nothing. If start0 threw a Throwable then
                 it will be passed up the call stack */</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>start( )方法是同步的，并且是启动这个线程进行执行，Java虚拟机将会调用这个线程的run方法，这样产生的结果是，两个线程执行着，其中一个是调用start（）方法的线程执行，另一个线程是执行run方法的线程。在start（）方法中，首先进行的是线程状态的判断，如果是一个JVM新启动的线程，那么threadStatus 的状态是为0的，如果线程不为0 将报出异常， 然后将线程添加到group中， group.add(this)方法中执行的结果是，通知group， 这个线程要执行了，所以可以添加进group中，并且这个线程组中没有没有启动的数量将减少。然后设置标识为， 接着调用本地方法started0，如果没有启动成功，将会通知这个线程组，没有启动成功，捕捉的异常将会忽略。</p> <h4 id="exit-方法"><a href="#exit-方法" aria-hidden="true" class="header-anchor">#</a> exit( )方法</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * This method is called by the system to give a Thread
 * a chance to clean up before it actually exits.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>group <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        group<span class="token punctuation">.</span><span class="token function">threadTerminated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        group <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* Aggressively null out all reference fields: see bug 4006245 */</span>
    target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">/* Speed the release of some of these resources */</span>
    threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    inheritableThreadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    inheritedAccessControlContext <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    blocker <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    uncaughtExceptionHandler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个方法的解释是说，exit( )是由系统调用的，用于线程在真正的退出前进行一些清理的操作。看看里面进行的操作是什么吧，可以看出，里面执行的是group 赋值为null了， 将target引用进行释放，同时释放了threadLocals所占用的资源，等等属性都赋值为null。</p> <h4 id="sleep-方法"><a href="#sleep-方法" aria-hidden="true" class="header-anchor">#</a> sleep()方法</h4> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">,</span> <span class="token keyword">int</span> nanos<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nanos <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> nanos <span class="token operator">&gt;</span> <span class="token number">999999</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;nanosecond timeout value out of range&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nanos <span class="token operator">&gt;=</span> <span class="token number">500000</span> <span class="token operator">||</span> <span class="token punctuation">(</span>nanos <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            millis<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span>millis<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>sleep（）方法在使用线程的时候，用的是比较多的。 这个方法的作用使得当前线程休眠一定的时间，但是这个期间是不释放持有的锁的。这个方法里面首先进行的是休眠时间的判断，然后又是调用本地方法。</p> <h4 id="stop-方法"><a href="#stop-方法" aria-hidden="true" class="header-anchor">#</a> stop( )方法</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Deprecated</span>
  <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">SecurityManager</span> security <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>security <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//检查是否有权限</span>
          <span class="token function">checkAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              security<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token class-name">SecurityConstants</span><span class="token punctuation">.</span>STOP_THREAD_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// A zero status value corresponds to &quot;NEW&quot;, it can't change to</span>
      <span class="token comment">// not-NEW because we hold the lock.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>threadStatus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Wake up thread if it was suspended; no-op otherwise</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// The VM can handle all thread states</span>
      <span class="token function">stop0</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadDeath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>stop( )方法是停止线程的执行，这个方法是一个不推荐使用的方法，已经被废弃了，因为使用该方法会出现异常情况。</p> <h4 id="join（）方法"><a href="#join（）方法" aria-hidden="true" class="header-anchor">#</a> join（）方法</h4> <p>join方法是等待该线程执行，直到超时或者终止，可以作为线程通信的一种方式，A线程调用B线程的join（阻塞），等待B完成后再往下执行。 join（）方法中重载了多个方法，但是主要的方法是下面的方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
    * Waits at most {@code millis} milliseconds for this thread to
    * die. A timeout of {@code 0} means to wait forever.
    *
    * &lt;p&gt; This implementation uses a loop of {@code this.wait} calls
    * conditioned on {@code this.isAlive}. As a thread terminates the
    * {@code this.notifyAll} method is invoked. It is recommended that
    * applications not use {@code wait}, {@code notify}, or
    * {@code notifyAll} on {@code Thread} instances.
    *
    * @param  millis
    *         the time to wait in milliseconds
    *
    * @throws  IllegalArgumentException
    *          if the value of {@code millis} is negative
    *
    * @throws  InterruptedException
    *          if any thread has interrupted the current thread. The
    *          &lt;i&gt;interrupted status&lt;/i&gt; of the current thread is
    *          cleared when this exception is thrown.
    */</span>
   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span>
   <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
       <span class="token comment">//得到当前的系统给时间</span>
       <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//如果是活跃的的</span>
           <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//无限期的等待</span>
               <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">long</span> delay <span class="token operator">=</span> millis <span class="token operator">-</span> now<span class="token punctuation">;</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token keyword">break</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token comment">//有限期的进行等待</span>
               <span class="token function">wait</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
               now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> base<span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre></div><h4 id="interrupt-方法"><a href="#interrupt-方法" aria-hidden="true" class="header-anchor">#</a> interrupt()方法</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">checkAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>blockerLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Interruptible</span> b <span class="token operator">=</span> blocker<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">interrupt0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// Just to set the interrupt flag</span>
            b<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">interrupt0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>interrupt()方法是中断当前的线程， 其实Thread类中有三个方法，比较容易混淆，在这里解释一下。</p> <ul><li>interrupt:将线程置为中断状态</li> <li>isInterrupt:线程是否中断</li> <li>interrupted:返回线程的上次的中断状态，并清除中断状态。</li></ul> <p>一般来说，阻塞函数：如Thread.sleep、Thread.join、Object.wait等在检查到线程的中断状态的时候，会抛出InteruptedExeption, 同时会清除线程的中断状态。</p> <p>对于InterruptedException的处理，可以有两种情况：</p> <ol><li>外层代码可以处理这个异常，直接抛出这个异常即可</li> <li>如果不能抛出这个异常，比如在run()方法内，因为在得到这个异常的同时，线程的中断状态已经被清除了，需要保留线程的中断状态，则需要调用Thread.currentThread().interrupt()</li></ol> <h3 id="线程的状态"><a href="#线程的状态" aria-hidden="true" class="header-anchor">#</a> 线程的状态</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
       <span class="token comment">/**
        * Thread state for a thread which has not yet started.
        */</span>
        <span class="token comment">//新建立的线程，还没有调用start()方法</span>
       NEW<span class="token punctuation">,</span>
       <span class="token comment">/**
        * Thread state for a runnable thread.  A thread in the runnable
        * state is executing in the Java virtual machine but it may
        * be waiting for other resources from the operating system
        * such as processor.
        */</span>
        <span class="token comment">// 可以运行，需要再等到其他资源(如CPU)就绪才能运行</span>
       RUNNABLE<span class="token punctuation">,</span>
       <span class="token comment">/**
        * Thread state for a thread blocked waiting for a monitor lock.
        * A thread in the blocked state is waiting for a monitor lock
        * to enter a synchronized block/method or
        * reenter a synchronized block/method after calling
        * {@link Object#wait() Object.wait}.
        */</span>
        <span class="token comment">//线程调用wait（）后等待内置锁进入同步方法或块中</span>
       BLOCKED<span class="token punctuation">,</span>
       <span class="token comment">/**
        * Thread state for a waiting thread.
        * A thread is in the waiting state due to calling one of the
        * following methods:
        *
        * &lt;p&gt;A thread in the waiting state is waiting for another thread to
        * perform a particular action.
        *
        * For example, a thread that has called &lt;tt&gt;Object.wait()&lt;/tt&gt;
        * on an object is waiting for another thread to call
        * &lt;tt&gt;Object.notify()&lt;/tt&gt; or &lt;tt&gt;Object.notifyAll()&lt;/tt&gt; on
        * that object. A thread that has called &lt;tt&gt;Thread.join()&lt;/tt&gt;
        * is waiting for a specified thread to terminate.
        */</span>
        <span class="token comment">// 在调用无参的wait(),Thread.join()或LockSupport.lock()方法后进入等待状态  </span>
       WAITING<span class="token punctuation">,</span>
       <span class="token comment">/**
        * Thread state for a waiting thread with a specified waiting time.
        * A thread is in the timed waiting state due to calling one of
        * the following methods with a specified positive waiting time:
        */</span>
          <span class="token comment">// 调用Thread.sleep(), 有时间参数的wait(), 有时间参数的Thread.join(), LockSupport.parkNanos或LockSupport.parkUtil方法后进行有期限的等待状态  </span>
       TIMED_WAITING<span class="token punctuation">,</span>
       <span class="token comment">/**
        * Thread state for a terminated thread.
        * The thread has completed execution.
        */</span>
           <span class="token comment">// 执行完毕的线程状态  </span>
       TERMINATED<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token class-name">State</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token comment">// get current thread state </span>
   <span class="token keyword">return</span> sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span>VM<span class="token punctuation">.</span><span class="token function">toThreadState</span><span class="token punctuation">(</span>threadStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>
</code></pre></div><h3 id="getcontextclassloader-方法"><a href="#getcontextclassloader-方法" aria-hidden="true" class="header-anchor">#</a> getContextClassLoader()方法</h3> <p>这个方法是上下文类加载器：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@CallerSensitive</span>
    <span class="token keyword">public</span> <span class="token class-name">ClassLoader</span> <span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>contextClassLoader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityManager</span> sm <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sm <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">checkClassLoaderPermission</span><span class="token punctuation">(</span>contextClassLoader<span class="token punctuation">,</span>
                                                   <span class="token class-name">Reflection</span><span class="token punctuation">.</span><span class="token function">getCallerClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> contextClassLoader<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token comment">// 设置类加载器</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContextClassLoader</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> cl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SecurityManager</span> sm <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sm <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sm<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimePermission</span><span class="token punctuation">(</span><span class="token string">&quot;setContextClassLoader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        contextClassLoader <span class="token operator">=</span> cl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>原文地址：https://wangchangchung.github.io/2016/12/05/Java%E5%B8%B8%E7%94%A8%E7%B1%BB%E6%BA%90%E7%A0%81%E2%80%94%E2%80%94Thread%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/ 感谢wangchangchung大神的知识分享</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/24/2019, 7:41:07 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java-source-code/ClassLoader.html" class="prev">
          ClassLoader
        </a></span> <span class="next"><a href="/java-source-code/ContextClassLoader.html">
          线程上下文类加载器
        </a>
        →
      </span></p></div> </div> <div class="page"><section class="page-edit"><div><span data-flag-title="Your Article Title" class="leancloud-visitors"><em class="post-meta-item-text">阅读量： </em> <i class="leancloud-visitors-count"></i></span></div> <h3><a href="javascript:;"></a>
      评 论：
    </h3> <div id="vcomments"></div></section></div> <!----></div></div>
    <script src="/assets/js/app.4deb0375.js" defer></script><script src="/assets/js/55.5eac4773.js" defer></script>
  </body>
</html>
